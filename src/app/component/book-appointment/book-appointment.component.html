<app-vavbar></app-vavbar>
<div class="appointment-container d-flex align-items-center justify-content-center min-vh-100">
  <div class="card shadow-lg p-4 rounded-4" style="max-width: 600px; width: 100%;">
    <h2 class="text-center mb-3">üìÖ Prendre un Rendez-vous</h2>
    <p class="text-muted text-center mb-4">Choisissez un m√©decin et une date pour votre rendez-vous</p>

    <form [formGroup]="form" (ngSubmit)="submit()" (ngchange)="clearMessages()">
      <div class="mb-3">
        <label for="doctorId" class="form-label">ü©∫ M√©decin *</label>
        <select id="doctorId" formControlName="doctorId" class="form-control" (change)="clearMessages()">
          <option value="">{{ loadingDoctors ? 'Chargement des m√©decins...' : (doctors.length === 0 ? 'Aucun m√©decin disponible' : 'S√©lectionnez un m√©decin') }}</option>
          @for (doctor of doctors; track doctor.id) {
            <option [value]="doctor.id">{{ doctor.name }}</option>
          }
        </select>
        
        <small class="text-muted d-block" *ngIf="!loadingDoctors && doctors.length > 0">
          {{ doctors.length }} m√©decin(s) disponible(s)
        </small>
        
        <small class="text-warning d-block" *ngIf="!loadingDoctors && doctors.length === 0 && !error">
          Aucun m√©decin trouv√© dans la base de donn√©es
        </small>
        
        <small class="text-danger" *ngIf="form.get('doctorId')?.invalid && form.get('doctorId')?.touched">
           Veuillez s√©lectionner un m√©decin
        </small>
      </div>

      <div class="mb-3">
        <label for="date" class="form-label"> Date du Rendez-vous *</label>
        <input type="date" id="date" formControlName="date"
               class="form-control" (change)="clearMessages()">
        <small class="text-muted">Veuillez s√©lectionner une date √† partir d'aujourd'hui</small>
        <small class="text-danger d-block" *ngIf="form.get('date')?.invalid && form.get('date')?.touched">
           La date est obligatoire
        </small>
      </div>

      <div class="mb-3">
        <label for="reason" class="form-label">üí¨ Motif de la consultation *</label>
        <textarea id="reason" formControlName="reason" class="form-control" rows="3" 
                  placeholder="D√©crivez bri√®vement le motif de votre consultation..." 
                  (input)="clearMessages()"></textarea>
        <small class="text-muted">Exemple: Consultation g√©n√©rale, contr√¥le m√©dical, probl√®me sp√©cifique...</small>
        <small class="text-danger d-block" *ngIf="form.get('reason')?.invalid && form.get('reason')?.touched">
           Le motif de consultation est obligatoire
        </small>
      </div>

      <button type="submit" class="btn btn-appointment w-100 mt-3" [disabled]="form.invalid || loading || loadingDoctors">
        <span *ngIf="loading"> R√©servation en cours...</span>
        <span *ngIf="!loading">‚úÖ R√©server mon Rendez-vous</span>
      </button>
    </form>

    <div *ngIf="success" class="alert alert-success mt-3 text-center border-0 shadow-sm">
        <div class="h5 mb-2"> <strong>Parfait!</strong></div>
        <p class="mb-2">{{ success }}</p>
        <small class="text-muted">Redirection automatique vers votre tableau de bord...</small>
    </div>
    
    <div *ngIf="error" class="alert alert-danger mt-3 text-center border-0 shadow-sm">
        <div class="h6 mb-2"> <strong>Oops!</strong></div>
        <p class="mb-0">{{ error }}</p>
    </div>
    
    <div *ngIf="result && !success" class="alert alert-info mt-3 text-center border-0 shadow-sm">
        <strong> D√©tails de votre r√©servation:</strong><br>
        <small>ID: {{ result.id }} | Date: {{ formatDate(result.date) }} | Statut: {{ result.status }}</small>
    </div>

    <div class="text-center mt-4" *ngIf="!loading">
      <button type="button" class="btn btn-outline-primary btn-sm me-2" (click)="router.navigate(['/patient/dashboard'])"> Retour au Tableau de Bord</button>
      <button type="button" class="btn btn-outline-secondary btn-sm" (click)="form.reset(); clearMessages()"> Nouveau Rendez-vous</button>
    </div>
  </div>
</div>
