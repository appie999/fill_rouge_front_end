<app-vavbar></app-vavbar>
<button class="mobile-menu-toggle" (click)="toggleMobileMenu()">
  <span>☰</span>
</button>

<div class="overlay" [class.show]="menuOpen" (click)="closeMobileMenu()"></div>

<div class="layout">
  <aside class="sidebar" [class.open]="menuOpen">
    <div class="brand">Clinic <b>IQ</b></div>

    <nav class="menu">
      <a class="menu-item active" routerLink="/patient/dashboard" (click)="closeMobileMenu()">
        <span class="mi">📊</span><span class="label">Tableau de Bord</span>
      </a>
    </nav>
  </aside>

  <main class="content">
    <header class="topbar">
      <div class="d-md-none"></div>
      <div class="dashboard-header">
        <h2>Bienvenue, {{ userName }} !</h2>
      </div>
    </header>


    <div *ngIf="successMessage" class="alert alert-success text-center border-0 shadow-sm mb-3">
      🎉 {{ successMessage }}
    </div>
    <div *ngIf="error" class="alert alert-danger text-center border-0 shadow-sm mb-3">
      ❌ {{ error }}
    </div>

    <section class="card">
      <div class="card-title">Mes Rendez‑vous</div>
      <div *ngIf="loading" class="text-center p-3">
        <p>Chargement des rendez-vous...</p>
      </div>
      <div *ngIf="error" class="text-danger p-3">
        <p><strong>Erreur:</strong> {{ error }}</p>
        <button class="btn btn-sm btn-primary" (click)="loadAppointments()">Réessayer</button>
      </div>
      <div class="table-wrapper" *ngIf="!loading && !error">
        <div class="table">
          <div class="thead">
            <div>DATE</div><div>MÉDECIN</div><div>STATUT</div>
          </div>
          <div class="tbody">
            <div class="tr" *ngFor="let appointment of appointments; let i = index">
              <div data-label="Date">{{ appointment.dateFormatted || formatDate(appointment.date) }}</div>
              <div data-label="Médecin">{{'Dr id.' + appointment.doctorId }}</div>
              <div data-label="Statut">
                <span class="pill" [ngClass]="getStatusClass(appointment.status)">
                  {{ appointment.statusText || getStatusText(appointment.status) }}
                </span>
              </div>
            </div>
            <div class="tr" *ngIf="!loading && !error && appointments.length === 0">
              <div colspan="6" class="text-center text-muted p-3">
                <p>Aucun rendez-vous trouvé</p>
                <p class="small">Cliquez sur "Prendre un Rendez-vous" pour réserver votre premier rendez-vous</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="quick-grid">
      <a class="quick-card" routerLink="/book-appointment">
        <span class="q-ico"></span><span class="q-text">Prendre un Rendez‑vous</span>
      </a>
    </section>
  </main>
</div>
